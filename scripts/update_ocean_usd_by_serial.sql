-- Script: Actualizar OCEAN USD segun SERIAL
-- Created: 2026-01-13
-- Description: Actualizar la columna inland OCEAN USD en purchases basandose en el serial de machines

-- Crear tabla temporal con los valores a actualizar
WITH serial_ocean_map AS (
  SELECT serial_value, ocean_value FROM (VALUES
    ('20095', 600),
    ('50505', 900),
    ('50711', 900),
    ('50765', 800),
    ('50812', 800),
    ('51030', 900),
    ('51362', 800),
    ('52042', 900),
    ('60190', 533),
    ('61025', 900),
    ('70032', 1500),
    ('70035', 1500),
    ('508482', 11000),
    ('70048', 1500),
    ('81357', 13500),
    ('81366', 15500),
    ('81635', 15500),
    ('80613', 13500),
    ('80495', 13500),
    ('81715', 13500),
    ('60476', 23000),
    ('70107', 1500),
    ('80271', 15500),
    ('70135', 1067),
    ('72458', 1500),
    ('70311', 1500),
    ('70329', 1067),
    ('70330', 1067),
    ('70403', 1500),
    ('98957', 7000),
    ('71080', 15500),
    ('70406', 1500),
    ('100038', NULL),
    ('307493', 10500),
    ('510832', 11000),
    ('71132', 1500),
    ('76658', 1500),
    ('305097', 11000),
    ('61250', 26000),
    ('302071', 11000),
    ('302060', 11000),
    ('95062', 7000),
    ('303477', 10500),
    ('507147', 11000),
    ('99018', 7000),
    ('303548', 11000),
    ('509609', 11000),
    ('302422', 11000),
    ('502227', 11000),
    ('510228', 11000),
    ('501729', 11000),
    ('70410', 1500),
    ('70419', 1500),
    ('70429', 1067),
    ('70472', 1500),
    ('50238', 12500),
    ('71006', 1500),
    ('71118', 1500),
    ('60689', 900),
    ('71686', 1500),
    ('70030', 1500),
    ('509083', 10500),
    ('80351', 15500),
    ('509383', 10500),
    ('502709', 11000),
    ('80337', 15500),
    ('61672', 23000),
    ('99225', 7000),
    ('306759', 11000),
    ('50112', 12500),
    ('507277', 11000),
    ('71148', 1167),
    ('77118', 1500),
    ('304997', 11000),
    ('301028', 11000),
    ('307556', 11000),
    ('91693', 7000),
    ('93965', 7000),
    ('517312', 7000),
    ('500912', 11000),
    ('506313', 11000),
    ('305682', 11000),
    ('305812', 11000),
    ('94565', 7000),
    ('73108', 1500),
    ('74118', 1500),
    ('72146', 1500),
    ('71919', 1500),
    ('71330', 1767),
    ('100155', 7000),
    ('303302', 11000),
    ('303948', 11000),
    ('307351', 11000),
    ('512792', 11000),
    ('71646', 15500),
    ('104060', 7000),
    ('501728', 11000),
    ('101770', 7000),
    ('72002', 1167),
    ('511259', 11000),
    ('303898', 11000),
    ('507205', 13000),
    ('72391', 1500),
    ('72410', 1500),
    ('72457', 1500),
    ('72470', 1500),
    ('72673', 1500),
    ('516501', 7000),
    ('104022', 7000),
    ('75260', 1500),
    ('103003', 7000),
    ('506548', 11000),
    ('500902', 11000),
    ('73661', 1500),
    ('301552', 10500),
    ('501216', 11000),
    ('305652', 10500),
    ('307367', 11000),
    ('75261', 1767),
    ('304025', 10500),
    ('72399', 1500),
    ('70637', 1500),
    ('305621', 11000),
    ('50071', 12500),
    ('501160', 11000),
    ('500936', 11000),
    ('95233', 7000),
    ('510291', 11000),
    ('305593', 11000),
    ('70876', 1500),
    ('75499', 1500),
    ('71652', 15500),
    ('104452', 7000),
    ('100426', 7000),
    ('94963', 7000),
    ('25159', 600),
    ('25051', 600),
    ('15682', 600),
    ('512010', 11000),
    ('512011', 11000),
    ('301386', 11000),
    ('303561', 11000),
    ('99060', 7000),
    ('75352', 1500),
    ('506422', 11000),
    ('510196', 11000),
    ('50337', 900),
    ('307507', 11000),
    ('301436', 11000),
    ('507582', 11000),
    ('510642', 11000),
    ('75611', 1500),
    ('94341', 1633),
    ('5695308', 167),
    ('5695314', 167),
    ('5695316', 167),
    ('5695318', 167),
    ('5695319', 167),
    ('5695321', 167),
    ('5695322', 167),
    ('5695323', 167),
    ('501161', 11000),
    ('307369', 11000),
    ('305452', 11000),
    ('305585', 11000),
    ('102270', 7000),
    ('104051', 7000),
    ('512922', 7000),
    ('104053', 7000),
    ('103520', 7000),
    ('502639', 11000),
    ('500917', 11000),
    ('81632', 13500),
    ('102272', 7000),
    ('73139', 1500),
    ('72721', 1500),
    ('52087', 900),
    ('74627', 1500),
    ('71542', 13500),
    ('93383', 7000),
    ('511182', 7000),
    ('91788', 7000),
    ('51896', 900),
    ('20773', 600),
    ('27425', 333),
    ('22002', 600),
    ('305638', 11000),
    ('52595', 900),
    ('507298', 11000),
    ('512086', 11000),
    ('512132', 11000),
    ('512375', 11000),
    ('73609', 1500),
    ('303950', 11000),
    ('26567', 600),
    ('70322', 1135),
    ('302902', 11000),
    ('72599', 1135),
    ('305203', 11000),
    ('307101', 11000),
    ('501437', 11000),
    ('72086', 1500),
    ('307355', 11000),
    ('511878', 7000),
    ('94780', 7000),
    ('301682', 11000),
    ('305698', 11000),
    ('305732', 11000),
    ('502309', 11000),
    ('502321', 11000),
    ('502327', 11000),
    ('507081', 11000),
    ('511188', 7000),
    ('512363', 11000),
    ('502500', 11000),
    ('502666', 11000),
    ('506491', 11000),
    ('25242C', NULL),
    ('51312', 900),
    ('509886', 7000),
    ('61725', 900),
    ('94892', 7000),
    ('26007', 600),
    ('21127C', NULL),
    ('27558', 600),
    ('72370', 1500),
    ('840008', 13500),
    ('91793', 7000),
    ('305759', 11000),
    ('92619', 7000),
    ('307107', 11000),
    ('501993', 11000),
    ('507185', 11000),
    ('506965', 11000),
    ('27262', 333),
    ('508686', 6333),
    ('103865', 6333),
    ('500920', 8333),
    ('501790', 11000),
    ('96336', 7000),
    ('501063', 11000),
    ('506075', 11000),
    ('304750', 9033),
    ('304223', 9033),
    ('71372', 13067),
    ('303970', 9266),
    ('502322', 9266),
    ('502323', 9266),
    ('99129', 7000),
    ('71041', 1400),
    ('940214', 12724),
    ('840514', 20994),
    ('840483', 20994),
    ('501362', 11000),
    ('502422', 11000),
    ('304925', 9633),
    ('94336', 7000),
    ('94495', 7000),
    ('502966', 11000),
    ('73791', 1400),
    ('306127', 12467),
    ('70319', 1567),
    ('70391', 1567),
    ('72071', 3287),
    ('72025', 3287),
    ('502883', 12100),
    ('50480', 10667),
    ('50138', 10667),
    ('302719', 9333),
    ('103303', 6400),
    ('509607', 9333),
    ('500890', 9333),
    ('100212', 5767),
    ('305790', 11000),
    ('305945', 11000),
    ('305969', 11000),
    ('307487', 11000),
    ('508572', 11000),
    ('511115', 11000),
    ('506565', 9067),
    ('303502', 11080),
    ('511173', 11000),
    ('513626', 7013),
    ('502891', 12100),
    ('512519', 7000),
    ('501188', 11120),
    ('307331', 11080),
    ('307490', 11100),
    ('102003', 7433),
    ('501438', 11113),
    ('502426', 11667),
    ('306973', 11333),
    ('97049', 7053),
    ('99847', 7053),
    ('95000', 7053),
    ('94288', 7333),
    ('508033', 11133),
    ('103045', 7647),
    ('96383', 7533),
    ('305015', 11667),
    ('306431', 11667),
    ('303459', 11667),
    ('501922', 10687),
    ('512566', 10687),
    ('307728', 10600),
    ('302037', 10600),
    ('303968', 10600),
    ('303617', 10600),
    ('94998', 6880),
    ('507179', 10667),
    ('514021', 7067),
    ('517699', 7067),
    ('92511', 7000),
    ('100189', 7100),
    ('100193', 7100),
    ('97565', 7100),
    ('516111', 7067),
    ('301643', 12220),
    ('500606', 10950),
    ('940291', 14700),
    ('516065', 7000),
    ('5648987', 267),
    ('5648992', 267),
    ('5648997', 267),
    ('5649008', 267),
    ('5649020', 267),
    ('51590', 667),
    ('92356', 1333),
    ('53126', 667),
    ('100206', 1333),
    ('5649021', 267),
    ('5649030', 267),
    ('5649033', 267),
    ('506467', 2167),
    ('5676622', 267),
    ('5676629', 267),
    ('92877', 7067),
    ('91676', 7067),
    ('NEW', 267),
    ('99193', 1967),
    ('70291', 1167),
    ('72991', 1167),
    ('304960', 2533),
    ('70476', 1067),
    ('70481', 1067),
    ('5676638', 267),
    ('5697466', 267),
    ('5719514', 267),
    ('5848988', 267),
    ('1PARTS ZX200', 200),
    ('2PARTS ZX200', 67),
    ('71988', 1267),
    ('301817', NULL),
    ('3PARTS ZX200', 133),
    ('4PARTS ZX200', 200),
    ('74202', 1267),
    ('304389', 4000),
    ('303025', 11200),
    ('70558', 1133),
    ('74161', 1133),
    ('307581', 10667),
    ('71268', 15867),
    ('95871', NULL),
    ('70448', 667),
    ('307635', 10667),
    ('307119', 3267),
    ('305885', 11667),
    ('305835', 11667)
  ) AS t(serial_value, ocean_value)
)
UPDATE purchases p
SET inland = m.ocean_value,
    updated_at = NOW()
FROM serial_ocean_map m
INNER JOIN machines ma ON p.machine_id = ma.id
WHERE TRIM(UPPER(COALESCE(ma.serial, ''))) = TRIM(UPPER(m.serial_value))
  AND ma.serial IS NOT NULL
  AND ma.serial != '';

-- Verificar resultados: mostrar cuantos registros se actualizaron
SELECT 
  COUNT(*) as total_actualizados,
  COUNT(CASE WHEN p.inland IS NOT NULL THEN 1 END) as con_valor,
  COUNT(CASE WHEN p.inland IS NULL THEN 1 END) as sin_valor
FROM purchases p
INNER JOIN machines ma ON p.machine_id = ma.id
WHERE EXISTS (
  SELECT 1 FROM (VALUES
    ('20095'), ('50505'), ('50711'), ('50765'), ('50812'), ('51030'), ('51362'), ('52042'), ('60190'), ('61025'),
    ('70032'), ('70035'), ('508482'), ('70048'), ('81357'), ('81366'), ('81635'), ('80613'), ('80495'), ('81715'),
    ('60476'), ('70107'), ('80271'), ('70135'), ('72458'), ('70311'), ('70329'), ('70330'), ('70403'), ('98957'),
    ('71080'), ('70406'), ('100038'), ('307493'), ('510832'), ('71132'), ('76658'), ('305097'), ('61250'), ('302071'),
    ('302060'), ('95062'), ('303477'), ('507147'), ('99018'), ('303548'), ('509609'), ('302422'), ('502227'), ('510228'),
    ('501729'), ('70410'), ('70419'), ('70429'), ('70472'), ('50238'), ('71006'), ('71118'), ('60689'), ('71686'),
    ('70030'), ('509083'), ('80351'), ('509383'), ('502709'), ('80337'), ('61672'), ('99225'), ('306759'), ('50112'),
    ('507277'), ('71148'), ('77118'), ('304997'), ('301028'), ('307556'), ('91693'), ('93965'), ('517312'), ('500912'),
    ('506313'), ('305682'), ('305812'), ('94565'), ('73108'), ('74118'), ('72146'), ('71919'), ('71330'), ('100155'),
    ('303302'), ('303948'), ('307351'), ('512792'), ('71646'), ('104060'), ('501728'), ('101770'), ('72002'), ('511259'),
    ('303898'), ('507205'), ('72391'), ('72410'), ('72457'), ('72470'), ('72673'), ('516501'), ('104022'), ('75260'),
    ('103003'), ('506548'), ('500902'), ('73661'), ('301552'), ('501216'), ('305652'), ('307367'), ('75261'), ('304025'),
    ('72399'), ('70637'), ('305621'), ('50071'), ('501160'), ('500936'), ('95233'), ('510291'), ('305593'), ('70876'),
    ('75499'), ('71652'), ('104452'), ('100426'), ('94963'), ('25159'), ('25051'), ('15682'), ('512010'), ('512011'),
    ('301386'), ('303561'), ('99060'), ('75352'), ('506422'), ('510196'), ('50337'), ('307507'), ('301436'), ('507582'),
    ('510642'), ('75611'), ('94341'), ('5695308'), ('5695314'), ('5695316'), ('5695318'), ('5695319'), ('5695321'), ('5695322'),
    ('5695323'), ('501161'), ('307369'), ('305452'), ('305585'), ('102270'), ('104051'), ('512922'), ('104053'), ('103520'),
    ('502639'), ('500917'), ('81632'), ('102272'), ('73139'), ('72721'), ('52087'), ('74627'), ('71542'), ('93383'),
    ('511182'), ('91788'), ('51896'), ('20773'), ('27425'), ('22002'), ('305638'), ('52595'), ('507298'), ('512086'),
    ('512132'), ('512375'), ('73609'), ('303950'), ('26567'), ('70322'), ('302902'), ('72599'), ('305203'), ('307101'),
    ('501437'), ('72086'), ('307355'), ('511878'), ('94780'), ('301682'), ('305698'), ('305732'), ('502309'), ('502321'),
    ('502327'), ('507081'), ('511188'), ('512363'), ('502500'), ('502666'), ('506491'), ('25242C'), ('51312'), ('509886'),
    ('61725'), ('94892'), ('26007'), ('21127C'), ('27558'), ('72370'), ('840008'), ('91793'), ('305759'), ('92619'),
    ('307107'), ('501993'), ('507185'), ('506965'), ('27262'), ('508686'), ('103865'), ('500920'), ('501790'), ('96336'),
    ('501063'), ('506075'), ('304750'), ('304223'), ('71372'), ('303970'), ('502322'), ('502323'), ('99129'), ('71041'),
    ('940214'), ('840514'), ('840483'), ('501362'), ('502422'), ('304925'), ('94336'), ('94495'), ('502966'), ('73791'),
    ('306127'), ('70319'), ('70391'), ('72071'), ('72025'), ('502883'), ('50480'), ('50138'), ('302719'), ('103303'),
    ('509607'), ('500890'), ('100212'), ('305790'), ('305945'), ('305969'), ('307487'), ('508572'), ('511115'), ('506565'),
    ('303502'), ('511173'), ('513626'), ('502891'), ('512519'), ('501188'), ('307331'), ('307490'), ('102003'), ('501438'),
    ('502426'), ('306973'), ('97049'), ('99847'), ('95000'), ('94288'), ('508033'), ('103045'), ('96383'), ('305015'),
    ('306431'), ('303459'), ('501922'), ('512566'), ('307728'), ('302037'), ('303968'), ('303617'), ('94998'), ('507179'),
    ('514021'), ('517699'), ('92511'), ('100189'), ('100193'), ('97565'), ('516111'), ('301643'), ('500606'), ('940291'),
    ('516065'), ('5648987'), ('5648992'), ('5648997'), ('5649008'), ('5649020'), ('51590'), ('92356'), ('53126'), ('100206'),
    ('5649021'), ('5649030'), ('5649033'), ('506467'), ('5676622'), ('5676629'), ('92877'), ('91676'), ('NEW'), ('99193'),
    ('70291'), ('72991'), ('304960'), ('70476'), ('70481'), ('5676638'), ('5697466'), ('5719514'), ('5848988'), ('1PARTS ZX200'),
    ('2PARTS ZX200'), ('71988'), ('301817'), ('3PARTS ZX200'), ('4PARTS ZX200'), ('74202'), ('304389'), ('303025'), ('70558'),
    ('74161'), ('307581'), ('71268'), ('95871'), ('70448'), ('307635'), ('307119'), ('305885'), ('305835')
  ) AS s(serial_val)
  WHERE TRIM(UPPER(COALESCE(ma.serial, ''))) = TRIM(UPPER(s.serial_val))
);

-- Mostrar algunos ejemplos de registros actualizados
SELECT 
  ma.serial,
  p.inland as ocean_usd,
  p.updated_at,
  p.mq
FROM purchases p
INNER JOIN machines ma ON p.machine_id = ma.id
WHERE EXISTS (
  SELECT 1 FROM (VALUES
    ('20095'), ('50505'), ('50711'), ('50765'), ('50812'), ('51030'), ('70032'), ('70035'), ('508482'), ('70048')
  ) AS s(serial_val)
  WHERE TRIM(UPPER(COALESCE(ma.serial, ''))) = TRIM(UPPER(s.serial_val))
)
ORDER BY ma.serial
LIMIT 20;
